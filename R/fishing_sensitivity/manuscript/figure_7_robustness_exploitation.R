#' Figure 7 : Robustness vs exploitation rate scatter plot

library(dplyr)
library(ggplot2)
library(ggrepel)

data.dir.fscale = '/net/work3/EDAB/atlantis/Shared_Data/fishing_sensitivity_manuscript/data/fscale_combined/'
figure.dir = '/net/work3/EDAB/atlantis/Shared_Data/fishing_sensitivity_manuscript/figures/manuscript/'

guild2spp = read.csv(here::here('diagnostics','functional_groups_match.csv'),as.is = T) %>% select(Code, Guild)
guild.colors = RColorBrewer::brewer.pal(11,'Paired')
names(guild.colors) = sort(unique(guild2spp$Guild))

data.slope = readRDS(paste0(data.dir.fscale,'robustness_fscale_combined.rds'))
data.fit = readRDS(paste0(data.dir.fscale,'biomass_numbers_fit.rds'))

data.all = data.slope %>%
  left_join(data.fit)%>%
  filter(!is.na(biomass.c))
  # mutate(biomass.steepness = ifelse(!is.na(biomass.c),biomass.c,biomass.a),
  #        number.steepness = ifelse(!is.na(number.c),number.c,number.a))

ggplot(data = data.all, aes(x = number.c,y = biomass.c, color = Guild,label = Code))+
  scale_color_manual(values = guild.colors)+
  geom_text_repel(alpha =0.8,size = 5,max.overlaps = 20)+
  # geom_text_repel()+
  xlab('Abundance Sensitivity')+
  ylab('Biomass Sensitivity')+
  theme_bw()+
  theme(legend.position = 'bottom')
ggsave(paste0(figure.dir,'/Figure_7_Constant_Catch_Sensitivity.png'),width = 8,height = 6,units = 'in',dpi = 300)
