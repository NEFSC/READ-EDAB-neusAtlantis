---
title: "Atlantis Development Workflow"
output: 
  html_document:
    keep_md: true
    css: styling.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


Once a task item has been created and assigned to a developer the following set of steps should be used as a guide.

1. Create a branch from the [master](https://github.com/NOAA-EDAB/neus-atlantis) and name it. The naming convention should include the task item ID plus a description. For example,

  `migratorySpecies-ATLNTS-45` or `RealisticZoo-ATLNTS-43`

1. Create "archive" folder in the testing branch if developer needs to run multiple instances of Atlantis (for a given task) in parallel.

1. When a task is complete:

    i. Copy the contents of the .prm files to the appropriate at_xxx_test.prm file in the `testing` folder.
    
    ii. Any R files created during this task should be made into a function with arguments and its directions for use should be well documented. All R code should reside in the `R` folder of the branch. For example: see [exampleFunction.R](https://raw.githubusercontent.com/NOAA-EDAB/neus-atlantis/master/R/exampleFunction.R)
    

1. Commit the changes to the branch

1. Initiate a pull request and make sure the title of the pull request is descriptive. Since other team members will be reviewing the pull request please make detailed comments regarding what was changed.

1. Make sure there a no conflicts.

1. Other team member will be notified of your request via email. They will be required to review the request, possibly test the changes (by running the code locally), and ultimately merge the pull request.

1. Delete branch on gitHub 

    > Note: The branch will remain on your PC even if you try to pull the deleted branch from gitHub. If you make changes to this branch locally in the future and then commit and push these changes,  the branch will be recreated.
    >
    > To remove the branch locally type the following in the terminal:
    >
    > `git branch -d branchName`
    >
    > `git fetch -p`
    >
    > For more info see [here](https://www.freecodecamp.org/news/how-to-delete-a-git-branch-both-locally-and-remotely/)

1. Repeat with additional tasks

## Change the default editor

You will find the terminal is needed for some git commands, mostly to "get out of trouble". A few steps for Rstudio

* First change the environment in which you'll be making these commands. Change the terminal:

    > `Tools -> Global Options -> Terminal`

Select Git Bash from the dropdown under the `shell` header. 

* Open a new Terminal:

    > `Tools -> Terminal -> New Terminal`

* Check to see if you have `nano` editor installed

    > Type `nano test` in the terminal. 
    > If it opens type Ctrl + X to close.

* Change the default editor `VI` to [nano](https://www.oreilly.com/library/view/gitlab-cookbook/9781783986842/apas07.html)

    >Type `git config --global core.editor "nano"` in the terminal

You should now have a good editor for custom git commands.

## Useful git commands

Git resources

* [https://git-scm.com/docs](https://git-scm.com/docs)
* [Undo stuff - 2015](https://github.blog/2015-06-08-how-to-undo-almost-anything-with-git/)
* [Pro Git book](https://git-scm.com/book/en/v2) and its [repo](https://github.com/progit/progit2)

### git rebase

Scenario: You commit a large file (100+MB) then subsequently make additional commits. When you push to GitHub, you recieve an error similar to this.

```{r error1, echo = FALSE}
knitr::include_graphics(path="https://raw.githubusercontent.com/NOAA-EDAB/neus-atlantis/master/docs/GitError-LargeFileSize.PNG")
```

You now want to remove the commit for the large file and push all subsequent commits.

1. Make sure you have no pending commits and that (in the following steps) you remove all commits related to the large file (for example, if you tried a git revert)

2. This removes the commit AND THE LARGE FILE from your local repo. Be sure to make a copy of the large file!

    > git rebase -i \< commit SHA \>
    >
    > Select a commit message before the one you want to remove
    > The \<commit SHA\> can be found in the history in RStudios commit window.
    
3. When the `nano` editor opens find the line that reflects the commit you want to delete (circled)

```{r nano1, echo = FALSE}
knitr::include_graphics(path="https://raw.githubusercontent.com/NOAA-EDAB/neus-atlantis/master/docs/rebaseInNano-LargeFileSize.PNG")
```

Follow these steps:

    > Delete the line
    > Ctrl + X to exit
    >
    > Save "modified buffer" to default location

### git reset

examples coming ...

### git revert

examples coming ...


## Testing environment

A test environment (repo) has been created called [atlantis_test](https://github.com/andybeet/atlantis_test) for developers to practive creating branches, conflicts, pull requests, and for merging pull requests. 

This repo can be cloned in Rstudio.

1. File -> New Project
1. Select Version Control
1. Select Git
1. Enter the url of the gitHub repository
1. Give the name of the directory to be created on your machine to hold the repo
1. Select the location of the directory (named above)
1. Click "Create Project"

